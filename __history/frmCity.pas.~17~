unit frmCity;

interface

uses
  module, Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, StdCtrls, ExtCtrls;

type
  TForm2 = class(TForm)
    Panel1: TPanel;
    Label4: TLabel;
    Label2: TLabel;
    Label1: TLabel;
    Label3: TLabel;
    txtPostCodeEnd: TEdit;
    txtPostCodeStart: TEdit;
    txtCode: TEdit;
    cbState: TComboBox;
    txtName: TEdit;
    Panel2: TPanel;
    btnSave: TButton;
    btnRemove: TButton;
    procedure btnSaveClick(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    function validates(): boolean;
  private
    { Private declarations }
  public
    { Public declarations }
    newRecord: Boolean;
  end;

var
  Form2: TForm2;
  dt: TDm;

implementation

{$R *.dfm}

procedure TForm2.btnSaveClick(Sender: TObject);
begin

  validates();

  dt.sqlCity.Close;
  dt.sqlCity.SQL.Clear;
  dt.sqlCity.SQL.Add('INSERT INTO cidades (codigo_cidade, nome, estado, cep_inicial, cep_final) VALUES ('+
          QuotedStr(txtCode.Text)+ ', ' + QuotedStr(txtName.Text) + ', ' + QuotedStr(txtState.Text) + ', ' + QuotedStr(txtPostCodeStart.Text) + ',' + QuotedStr(txtPostCodeEnd.Text) + ')' );
  dt.sqlCity.ExecSQL();

end;

function TForm2.validates(): boolean;
begin

  if Length(txtCode.Text) = 0 then
  begin
    ShowMessage('Por favor, preencha o código da cidade para continuar!');
    validates := false;
    txtCode.SetFocus;
    exit;
  end
  else
    if newRecord then
    begin
      dt.sqlCity.SQL.Add('SELECT COUNT(*) AS qtd FROM cidades WHERE codigo_cidade = ' + QuotedStr(txtCode.Text));
      dt.sqlCity.Open;

      if dt.sqlCity.FieldByName('qtd').Value > 0  then
      begin
        ShowMessage('O código da cidade deve ser único!');
        validates := false;
        txtCode.SetFocus;
        exit;
      end;

    end;

  if Length(txtName.Text) = 0 then
  begin
    ShowMessage('Por favor, preencha o nome da cidade para continuar!');
    validates := false;
    txtName.SetFocus;
    exit;
  end;

  if cbState.ItemIndex = -1 then
  begin
    ShowMessage('Por favor, selecione o estado da cidade para continuar!');
    validates := false;
    cbState.SetFocus;
    exit;
  end;

  if (Length(txtPostCodeStart.Text) = 0) OR (Length(txtPostCodeEnd.Text) = 0) then
  begin
    ShowMessage('Por favor, preencha corretamente a feixa de cep para continuar!');
    validates := false;
    txtPostCodeStart.SetFocus;
    exit;
  end;

end;

procedure TForm2.FormCreate(Sender: TObject);
begin

  dt := TDm.Create(Self);

end;

end.
