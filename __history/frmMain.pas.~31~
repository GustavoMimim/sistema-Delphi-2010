unit frmMain;

interface

uses
  module, frmCity, Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, ComCtrls, ExtCtrls, StdCtrls, pngimage, DB, ADODB;

type
  TForm1 = class(TForm)
    sideMenu: TTreeView;
    mainBody: TPanel;
    header: TPanel;
    Panel1: TPanel;
    Label1: TLabel;
    Edit1: TEdit;
    lvRecords: TListView;
    Panel2: TPanel;
    btnUpdate: TButton;
    btnAdd: TButton;
    procedure FormCreate(Sender: TObject);
    procedure btnAddClick(Sender: TObject);
    procedure btnUpdateClick(Sender: TObject);
    procedure sideMenuClick(Sender: TObject);
    procedure ListCities();
    procedure ListCustomers();
  private
    { Private declarations }
  public
    { Public declarations }
    procedure directsTypeList();
  end;

var
  Form1: TForm1;
  Form2: TForm2;
  dt: TDm;
  typeSelected: String;

implementation

{$R *.dfm}

procedure TForm1.btnAddClick(Sender: TObject);
begin

  Form2 := TForm2.Create(nil);

  Form2.newRecord := true;
  Form2.btnRemove.Visible := false;
  Form2.Show;

end;

procedure TForm1.btnUpdateClick(Sender: TObject);
begin

  if lvRecords.ItemIndex = 0 then
  begin
    ShowMessage('Por favor, selecione um registro!');
    exit;
  end;

  Application.CreateForm(TForm2, Form2);
  Form2.loadCity(lvRecords.Selected.Caption);
  Form2.Show;

end;

procedure TForm1.directsTypeList();
begin

  if typeSelected = 'Cidades' then
    ListCities();
  if typeSelected = 'Clientes' then
    ListCustomers();

end;

procedure TForm1.ListCustomers();
var
  item: TListItem;
  col: TListColumn;

begin

  lvRecords.Clear;
  lvRecords.Columns.Clear;

  Col := lvRecords.Columns.Add;
  Col.Caption := 'Código';
  Col.Width := 80;

  Col := lvRecords.Columns.Add;
  Col.Caption := 'Nome';
  Col.Width := 160;

  Col := lvRecords.Columns.Add;
  Col.Caption := 'Telefone';
  Col.Width := 120;

  Col := lvRecords.Columns.Add;
  Col.Caption := 'Cidade';
  Col.Width := 150;

  dt.sqlCity.SQL.Clear;

  dt.sqlCity.SQL.Add('SELECT * from clientes LEFT JOIN cidades ON clientes.codigo_cidade = cidades.codigo');

  dt.sqlCity.Open;

  while not dt.sqlCity.Eof do
  begin

    item := lvRecords.Items.Add;

    item.Caption := dt.sqlCity.FieldByName('codigo_cidade').Value;

    item.SubItems.Add(dt.sqlCity.FieldByName('nome').Value);

    item.SubItems.Add(dt.sqlCity.FieldByName('estado').Value);

    item.SubItems.Add(dt.sqlCity.FieldByName('cep_inicial').Value + ' a ' + dt.sqlCity.FieldByName('cep_final').Value);

    dt.sqlCity.Next;

  end;

end;

procedure TForm1.ListCities();
var
  item: TListItem;
  col: TListColumn;

begin

  lvRecords.Clear;
  lvRecords.Columns.Clear;

  Col := lvRecords.Columns.Add;
  Col.Caption := 'Código';
  Col.Width := 80;

  Col := lvRecords.Columns.Add;
  Col.Caption := 'Nome';
  Col.Width := 160;

  Col := lvRecords.Columns.Add;
  Col.Caption := 'UF';
  Col.Width := 120;

  Col := lvRecords.Columns.Add;
  Col.Caption := 'Feixa de Cep';
  Col.Width := 150;

  dt.sqlCity.SQL.Clear;

  dt.sqlCity.SQL.Add('SELECT * from cidades');

  dt.sqlCity.Open;

  while not dt.sqlCity.Eof do
  begin

    item := lvRecords.Items.Add;

    item.Caption := dt.sqlCity.FieldByName('codigo_cidade').Value;

    item.SubItems.Add(dt.sqlCity.FieldByName('nome').Value);

    item.SubItems.Add(dt.sqlCity.FieldByName('estado').Value);

    item.SubItems.Add(dt.sqlCity.FieldByName('cep_inicial').Value + ' a ' + dt.sqlCity.FieldByName('cep_final').Value);

    dt.sqlCity.Next;

  end;

end;

procedure TForm1.FormCreate(Sender: TObject);
begin

  dt := TDm.Create(Self);

  typeSelected := 'Cidades';

  createList();

end;

procedure TForm1.sideMenuClick(Sender: TObject);
begin

  typeSelected := sideMenu.Selected.Text;


end;

end.
